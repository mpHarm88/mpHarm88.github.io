---

layout: post
title: ðŸ”Ž Exploring Black Box Classification Models using Google Analytics Data
subtitle: Use my dashboard to make real time predictions.
bigimg: img/black_box.jpg
image: img/black_box.jpg, img/randomforest.png, img/xgbclassifier.png, img/xgbshap.png, img/rfshap.png
tags: [xgboost, pandas, scikit-learn, eli5, shap, pdpbox, category-encoders, numpy]

---

## Find the heroku webapp [here](https://cust-pred.herokuapp.com)


### XGBoost

```python
model = XGBClassifier()

pipe = make_pipeline(
    ce.OneHotEncoder(),
    SimpleImputer(),
)

pipeline = Pipeline([("pipe",pipe), 
                    ("clf", model)])

param_grid = {
    "pipe__onehotencoder__drop_invariant": [True],
    "pipe__simpleimputer__strategy": ["mean", "median", "most_frequent"],
    "clf__model__n_estimators": [random.randint(300,1000)],
    "clf__model__max_depth": [random.randint(1,15)],
    "clf__model__learning_rate": [0.1, 0.2, 0.3, 0.4],
    "clf__model__gamma": [0.1, 0.2, 0.3, 0.4],
    "clf__model__min_child_weight": [1, 2, 3, 4, None]
}

g_model = RandomizedSearchCV(pipeline, 
                             n_iter=1000, 
                             param_distributions=param_grid, 
                             n_jobs=-1, 
                             cv=5,
                             return_train_score=True,
                             scoring="roc_auc",
                             verbose=1)

g_model.fit(training.drop(columns="Revenue"), training[["Revenue"]])
```

### Random Forest

```python
forest_pipe = make_pipeline(
    ce.OrdinalEncoder(),
    RandomForestClassifier(
        n_estimators=100, 
        n_jobs=-1,
        max_depth=10
    ),
    verbose=True
)


forest_pipe.fit(training.drop(columns="Revenue"), training[["Revenue"]])
```

### Confusion Matrix (Revenue=0, No Revenue=1)

<div align="center">
  <img src="/img/xgbclassifier.png"><img src="/img/randomforest.png">
</div>

### Shapley Values
How did the models predict the same prediction differently?

<h1 align="center">Centered text!</h1>

<div align="center">
  <img src="/img/xgbshap.png">
</div>

#### Random Forest
<div align="center">
  <img src="/img/rfshap.png">
</div>

